<!doctype html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Â·</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{display:flex;align-items:center;justify-content:center;
     background:#000 center/cover no-repeat;transition:opacity .35s}
#wrapper{position:absolute;top:25%;left:50%;transform:translateX(-50%);
         width:80vw;max-width:320px}
#q{width:100%;padding:14px 0;border:none;border-radius:26px;
   font:16px/1.4 sans-serif;background:rgba(0,0,0,.45);color:#fff;text-align:center;outline:none}
#btn{position:absolute;left:10px;top:50%;transform:translateY(-50%);
     width:24px;height:24px;border:none;border-radius:50%;background:rgba(255,255,255,.25);
     color:#fff;font:12px/24px sans-serif;cursor:pointer}
#wallBtn{position:fixed;top:12px;left:12px;padding:6px 8px;border:none;border-radius:14px;
         font:12px sans-serif;background:rgba(0,0,0,.5);color:#fff;cursor:pointer;z-index:9}
#wallMenu{position:fixed;top:44px;left:12px;display:none;flex-direction:column;gap:4px;z-index:9}
#wallMenu button{padding:6px 10px;border:none;border-radius:12px;font:12px sans-serif;
                background:rgba(0,0,0,.6);color:#fff;cursor:pointer}
input[type=file]{display:none}
</style>

<!-- å£çº¸èœå• -->
<button id="wallBtn">ğŸ¨</button>
<nav id="wallMenu">
  <button onclick="loadWall('bing')">Bing éšæœºæ—¥</button>
  <button onclick="loadWall('unsplash')">Unsplash</button>
  <button onclick="loadWall('picsum')">Picsum</button>
  <button onclick="loadWall('custom')">æˆ‘çš„å›¾åº“</button>
  <label style="padding:6px 10px;border-radius:12px;background:rgba(0,0,0,.6);color:#fff;cursor:pointer">
    æ·»åŠ æœ¬åœ°å›¾
    <input type="file" multiple accept="image/*" onchange="addCustom(this.files)">
  </label>
</nav>

<!-- æœç´¢æ¡† -->
<div id="wrapper">
  <form id="f">
    <button id="btn" type="button">B</button>
    <input id="q" placeholder="æœç´¢â€¦" autofocus>
  </form>
</div>

<script>
/* ---------- å£çº¸æ±  ---------- */
const src = {
  /* éå®˜æ–¹é•œåƒï¼Œæ”¯æŒ idx=0-7ï¼ˆä»Šå¤©â†’7å¤©å‰ï¼‰ */
  bing: () => {
    const idx = Math.floor(Math.random()*8); // 0-7 éšæœºå†å²æ—¥
    return `https://bing.wallpaper.pics/v1?resolution=1920x1080&index=${idx}&r=${Date.now()}`;
  },
  unsplash: () => `https://source.unsplash.com/1920x1080?sig=${Math.random()}`,
  picsum: () => `https://picsum.photos/1920/1080?random=${Date.now()}`,
  custom: () => localImgs.length ? localImgs[Math.floor(Math.random()*localImgs.length)]
                                : src.bing()
};

/* ---------- æœ¬åœ°å›¾åº“ ---------- */
let localImgs = JSON.parse(localStorage.getItem('myWalls') || '[]');
function addCustom(files){
  [...files].forEach(f=>{
    const reader = new FileReader();
    reader.onload = e=>{
      localImgs.push(e.target.result);
      localStorage.setItem('myWalls', JSON.stringify(localImgs));
    };
    reader.readAsDataURL(f);
  });
}

/* ---------- å£çº¸åŠ è½½ï¼ˆæ— é»‘é—ªï¼‰ ---------- */
let cache = new Image();
function loadWall(type){
  const url = src[type]();
  if(typeof url === 'string' && url.startsWith('http')){
    cache.src = url;
    cache.onload = ()=>document.body.style.background = `url(${url}) center/cover no-repeat`;
  }else{
    document.body.style.background = url;
  }
}

/* ---------- èœå•æŠ˜å  ---------- */
wallBtn.onclick = ()=> wallMenu.style.display = wallMenu.style.display === 'flex' ? 'none' : 'flex';

/* ---------- æœç´¢å¼•æ“ ---------- */
let engine = 'https://cn.bing.com/search?q=';
btn.onclick = ()=>{
  engine = engine.includes('bing') ? 'https://www.google.com/search?q=' : 'https://cn.bing.com/search?q=';
  btn.textContent = engine.includes('bing') ? 'B' : 'G';
};
f.onsubmit = e=>{
  e.preventDefault();
  location.href = engine + encodeURIComponent(q.value);
};

/* åˆå§‹å£çº¸ */
loadWall('bing');
</script>
