<!doctype html>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Â·</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{display:flex;align-items:center;justify-content:center;
     background:#000 center/cover no-repeat;transition:opacity .35s}
#wrapper{position:absolute;top:25%;left:50%;transform:translateX(-50%);
         width:80vw;max-width:320px}
#q{width:100%;padding:14px 0;border:none;border-radius:26px;
   font:16px/1.4 sans-serif;background:rgba(0,0,0,.45);color:#fff;text-align:center;outline:none}
#btn{position:absolute;left:10px;top:50%;transform:translateY(-50%);
     width:24px;height:24px;border:none;border-radius:50%;background:rgba(255,255,255,.25);
     color:#fff;font:12px/24px sans-serif;cursor:pointer}
#wallBtn{position:fixed;top:12px;left:12px;padding:6px 8px;border:none;border-radius:14px;
         font:12px sans-serif;background:rgba(0,0,0,.5);color:#fff;cursor:pointer;z-index:9}
#wallMenu{position:fixed;top:44px;left:12px;display:none;flex-direction:column;gap:4px;z-index:9}
#wallMenu button{padding:6px 10px;border:none;border-radius:12px;font:12px sans-serif;
                background:rgba(0,0,0,.6);color:#fff;cursor:pointer}
input[type=file]{display:none}
</style>

<!-- å£çº¸èœå• -->
<button id="wallBtn">ğŸ¨</button>
<nav id="wallMenu">
  <button onclick="loadWall('bing')">Bing å†å²</button>
  <button onclick="loadWall('picsum')">Picsum</button>
  <button onclick="loadWall('custom')">æˆ‘çš„å›¾åº“</button>
  <label style="padding:6px 10px;border-radius:12px;background:rgba(0,0,0,.6);color:#fff;cursor:pointer">
    æ·»åŠ æœ¬åœ°å›¾
    <input type="file" multiple accept="image/*" onchange="addCustom(this.files)">
  </label>
</nav>

<!-- æœç´¢æ¡† -->
<div id="wrapper">
  <form id="f">
    <button id="btn" type="button">B</button>
    <input id="q" placeholder="æœç´¢â€¦" autofocus>
  </form>
</div>

<script>
/* ---------- å£çº¸æ±  ---------- */
const src = {
  bing: async () => {
    try {
      const res = await fetch('https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=8&mkt=en-US');
      const data = await res.json();
      const img = data.images[Math.floor(Math.random()*data.images.length)];
      return 'https://www.bing.com' + img.url;
    } catch {
      return 'https://picsum.photos/1920/1080?random=' + Date.now();
    }
  },
  picsum: () => `https://picsum.photos/1920/1080?random=${Date.now()}`,
  custom: () => localImgs.length ? localImgs[Math.floor(Math.random()*localImgs.length)]
                                : 'https://picsum.photos/1920/1080?random=' + Date.now()
};

/* ---------- æœ¬åœ°å›¾åº“ ---------- */
let localImgs = JSON.parse(localStorage.getItem('myWalls') || '[]');
function addCustom(files){
  [...files].forEach(f=>{
    const reader = new FileReader();
    reader.onload = e=>{
      localImgs.push(e.target.result);
      localStorage.setItem('myWalls', JSON.stringify(localImgs));
    };
    reader.readAsDataURL(f);
  });
}

/* ---------- é¦–æ¬¡åŠ è½½ï¼š0 ç§’é»‘å± ---------- */
(async function initWall() {
  // 1. å…ˆæ”¾ä¸€å¼ åŒæ­¥å¤‡ç”¨å›¾
  document.body.style.background = 'url(https://picsum.photos/1920/1080?random=' + Date.now() + ') center/cover no-repeat';
  // 2. åå°æ‹‰ Bingï¼Œæ‹‰åˆ°äº†å†æ›¿æ¢
  const bingUrl = await src.bing();
  const img = new Image();
  img.src = bingUrl;
  img.onload = () => document.body.style.background = `url(${bingUrl}) center/cover no-repeat`;
})();

/* ---------- å£çº¸åŠ è½½ ---------- */
async function loadWall(type){
  const url = type === 'bing' ? await src.bing() : src[type]();
  const img = new Image();
  img.src = url;
  img.onload = () => document.body.style.background = `url(${url}) center/cover no-repeat`;
}

/* ---------- èœå•æŠ˜å  ---------- */
wallBtn.onclick = ()=> wallMenu.style.display = wallMenu.style.display === 'flex' ? 'none' : 'flex';

/* ---------- æœç´¢å¼•æ“ ---------- */
let engine = 'https://cn.bing.com/search?q=';
btn.onclick = ()=>{
  engine = engine.includes('bing') ? 'https://www.google.com/search?q=' : 'https://cn.bing.com/search?q=';
  btn.textContent = engine.includes('bing') ? 'B' : 'G';
};
f.onsubmit = e=>{
  e.preventDefault();
  location.href = engine + encodeURIComponent(q.value);
};
</script>
